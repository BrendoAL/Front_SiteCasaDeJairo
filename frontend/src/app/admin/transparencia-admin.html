<div class="admin-container">
  <h2>Gerenciar Transparência</h2>
  
  <!-- Status Messages -->
  <div *ngIf="carregando" class="loading">
    Processando...
  </div>

  <div *ngIf="erro" class="erro">
    Erro: {{ erro }}
    <button (click)="erro = ''" class="btn-close">×</button>
  </div>

  <!-- Formulário -->
  <form (ngSubmit)="salvarRegistro()" class="admin-form">
    <div class="form-row">
      <input [(ngModel)]="novoRegistro.titulo" 
             name="titulo" 
             placeholder="Título" 
             required 
             maxlength="200" 
             class="form-input">
      
      <input [(ngModel)]="novoRegistro.data" 
             type="date" 
             name="data" 
             class="form-input date-input">
    </div>

    <textarea [(ngModel)]="novoRegistro.descricao" 
              name="descricao" 
              placeholder="Descrição" 
              required
              maxlength="1000"
              rows="4"
              class="form-textarea"></textarea>

    <div class="file-upload-section">
      <input type="file" 
             (change)="onArquivoSelecionado($event)" 
             accept="image/*"
             class="file-input"
             id="fileInput">
      <label for="fileInput" class="file-label">
        <i class="fas fa-image"></i>
        {{ novoRegistro.imagem ? novoRegistro.imagem.name : 'Escolher imagem' }}
      </label>
      
      <!-- Preview da imagem -->
      <div *ngIf="editando && novoRegistro.postImagemId && !novoRegistro.imagem" class="image-preview">
        <img [src]="getImagem(novoRegistro.postImagemId)" 
             alt="Imagem atual" 
             class="preview-image">
        <span class="preview-label">Imagem atual</span>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" 
              class="btn-primary"
              [disabled]="carregando">
        {{ editando ? 'Salvar alterações' : 'Cadastrar' }}
      </button>
      
      <button *ngIf="editando" 
              type="button" 
              class="btn-secondary" 
              (click)="cancelarEdicao()">
        Cancelar
      </button>
    </div>
  </form>

  <hr>

  <!-- Lista de registros -->
  <div class="registros-section">
    <h3>Registros ({{ registros.length }})</h3>
    
    <div *ngIf="registros.length === 0 && !carregando" class="empty-state">
      <p>Nenhum registro encontrado</p>
    </div>

    <ul class="registros-list" *ngIf="registros.length > 0">
      <li *ngFor="let t of registros" class="registro-item">
        <div class="registro-content">
          <div class="registro-header">
            <b class="registro-titulo">{{ t.titulo }}</b>
            <span class="registro-data">{{ t.data | date:'dd/MM/yyyy' }}</span>
          </div>
          
          <p class="registro-descricao">
            {{ t.descricao.length > 150 ? (t.descricao | slice:0:150) + '...' : t.descricao }}
          </p>
          
          <div *ngIf="t.postImagemId" class="registro-image">
            <img [src]="getImagem(t.postImagemId)" 
                 alt="Imagem do post" 
                 class="thumbnail-image">
          </div>
        </div>
        
        <div class="registro-actions">
          <button (click)="atualizarRegistro(t)" class="btn-edit" title="Editar">
            ✏️
          </button>
          <button (click)="deletarRegistro(t.id!)" class="btn-delete" title="Excluir">
            🗑️
          </button>
        </div>
      </li>
    </ul>
  </div>
</div>
