<div class="admin-container">
  <h2>Gerenciar Eventos</h2>
  
  <!-- Status Messages -->
  <div *ngIf="carregando" class="loading">
    Processando...
  </div>

  <div *ngIf="erro" class="erro">
    Erro: {{ erro }}
    <button (click)="erro = ''" class="btn-close">√ó</button>
  </div>

  <!-- Formul√°rio -->
  <form (ngSubmit)="salvarEvento()" class="admin-form" #eventoForm="ngForm">
    <div class="form-row">
      <input [(ngModel)]="novoEvento.titulo" 
             name="titulo" 
             placeholder="T√≠tulo do evento" 
             required 
             maxlength="200" 
             class="form-input"
             #tituloInput="ngModel">
      
      <input [(ngModel)]="novoEvento.data" 
             type="date" 
             name="data" 
             required
             class="form-input date-input"
             #dataInput="ngModel">
    </div>
    
    <div class="form-row">
      <input [(ngModel)]="novoEvento.local" 
             name="local" 
             placeholder="Local do evento" 
             class="form-input">
    </div>

    <textarea [(ngModel)]="novoEvento.descricao" 
              name="descricao" 
              placeholder="Descri√ß√£o do evento" 
              required
              maxlength="1000"
              rows="4"
              class="form-textarea"
              #descricaoInput="ngModel"></textarea>

    <div class="file-upload-section">
      <input type="file" 
             (change)="onArquivoSelecionado($event)" 
             accept="image/*"
             class="file-input"
             id="eventoFileInput">
      <label for="eventoFileInput" class="file-label">
        <i class="fas fa-image"></i>
        {{ arquivoSelecionado ? arquivoSelecionado.name : 'Escolher imagem' }}
      </label>
      
      <!-- Preview da imagem -->
      <div *ngIf="previewUrl" class="image-preview">
        <img [src]="previewUrl" 
             alt="Preview da imagem" 
             class="preview-image">
        <span class="preview-label">Preview</span>
      </div>
      
      <!-- Imagem atual (quando editando) -->
      <div *ngIf="editando && novoEvento.eventoImagemId && !previewUrl" class="image-preview">
        <img [src]="getImagem(novoEvento.eventoImagemId)" 
             alt="Imagem atual" 
             class="preview-image"
             (error)="onImageError($event)">
        <span class="preview-label">Imagem atual</span>
      </div>
    </div>

    <!-- Valida√ß√£o visual -->
    <div class="form-validation" *ngIf="eventoForm.submitted">
      <div *ngIf="tituloInput.invalid" class="field-error">
        T√≠tulo √© obrigat√≥rio
      </div>
      <div *ngIf="dataInput.invalid" class="field-error">
        Data √© obrigat√≥ria
      </div>
      <div *ngIf="descricaoInput.invalid" class="field-error">
        Descri√ß√£o √© obrigat√≥ria
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" 
              class="btn-primary"
              [disabled]="carregando">
        {{ editando ? 'Salvar altera√ß√µes' : 'Cadastrar evento' }}
      </button>
      
      <button *ngIf="editando" 
              type="button" 
              class="btn-secondary" 
              (click)="cancelarEdicao()">
        Cancelar
      </button>
    </div>
  </form>

  <hr>

  <!-- Lista de eventos -->
  <div class="eventos-section">
    <h3>Eventos ({{ eventos.length }})</h3>
    
    <div *ngIf="eventos.length === 0 && !carregando" class="empty-state">
      <p>Nenhum evento encontrado. Cadastre o primeiro evento usando o formul√°rio acima.</p>
    </div>

    <ul class="eventos-list" *ngIf="eventos.length > 0">
      <li *ngFor="let e of eventos" class="evento-item">
        <div class="evento-content">
          <div class="evento-header">
            <b class="evento-titulo">{{ e.titulo }}</b>
            <span class="evento-data">{{ e.data | date:'dd/MM/yyyy' }}</span>
          </div>
          
          <div *ngIf="e.local" class="evento-local">
            <i class="fas fa-map-marker-alt"></i> {{ e.local }}
          </div>
          
          <p class="evento-descricao">
            {{ truncateText(e.descricao, 150) }}
          </p>
          
          <div *ngIf="e.eventoImagemId || e.imagemUrl" class="evento-image">
            <img [src]="getImageUrl(e)" 
                 [alt]="e.titulo" 
                 class="thumbnail-image"
                 (error)="onImageError($event)">
          </div>
        </div>
        
        <div class="evento-actions">
          <button (click)="editarEvento(e)" class="btn-edit" title="Editar">
            ‚úèÔ∏è
          </button>
          <button (click)="deletarEvento(e.id!)" class="btn-delete" title="Excluir">
            üóëÔ∏è
          </button>
        </div>
      </li>
    </ul>
  </div>
</div>